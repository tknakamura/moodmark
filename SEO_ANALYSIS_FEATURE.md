# SEO分析機能の追加

## 概要

GA4/GSC AI分析チャットに、ページコンテンツのスクレイピングとHTML/CSS解析機能を追加しました。これにより、SEO改善における分析やアドバイスの精度・質が大幅に向上します。

## 新機能

### 1. ページスクレイピング機能

- 指定されたURLのページを自動取得
- HTMLコンテンツの解析
- エラーハンドリングとタイムアウト対応

### 2. 包括的なSEO分析

#### 基本SEO要素
- タイトルタグ（長さ、最適化チェック）
- メタディスクリプション（長さ、最適化チェック）
- Canonical URL
- Robots meta

#### コンテンツ構造
- 見出しタグ（H1-H6）の分析
- 文字数・語数のカウント
- 段落・リストの数
- H1の最適性チェック（理想的には1つ）

#### 技術的SEO
- Open Graphタグ
- Twitter Card
- Viewport設定
- Charset設定
- 言語設定

#### パフォーマンス
- 外部リソース（スクリプト、スタイルシート）の数
- インラインCSS/スタイルの数
- 画像の遅延読み込み状況

#### アクセシビリティ
- 画像のalt属性カバレッジ
- リンクのテキスト有無
- フォームのラベル付け

#### 構造化データ
- JSON-LD
- マイクロデータ
- RDFa

#### リンク分析
- 内部リンク数
- 外部リンク数
- nofollowリンク数

#### 画像分析
- alt属性の有無
- 画像サイズ情報
- 遅延読み込み状況

#### CSS分析
- 外部CSSファイル数
- インラインCSS
- CSS最適化スコア

## 使用方法

### 方法1: URLを質問に含める

チャット入力でURLを含めて質問：

```
このページのSEO改善点は？ https://isetan.mistore.jp/moodmark/
```

### 方法2: サイドバーでURLを指定

1. サイドバーの「🔗 ページ分析」セクションでURLを入力
2. 質問を入力（URLは自動的に含まれます）

例：
- サイドバーに `https://isetan.mistore.jp/moodmark/` を入力
- チャットで「このページのSEO改善点は？」と質問

### 方法3: SEO分析の使用例ボタン

サイドバーの「🔍 SEO分析の使用例」から選択：
- 「このページのSEO改善点は？」
- 「タイトルとディスクリプションを最適化して」
- 「見出し構造を分析して」

## 分析される項目

### 基本SEO
- ✅ タイトルタグ（30-60文字が最適）
- ✅ メタディスクリプション（120-160文字が最適）
- ✅ Canonical URL
- ✅ Robots設定

### コンテンツ
- ✅ H1タグ（1つが最適）
- ✅ H2-H6タグの構造
- ✅ 文字数・語数
- ✅ コンテンツの長さ（300語以上推奨）

### アクセシビリティ
- ✅ 画像alt属性カバレッジ
- ✅ リンクテキスト
- ✅ フォームラベル

### 技術的SEO
- ✅ 構造化データ（JSON-LD、マイクロデータ、RDFa）
- ✅ Open Graph / Twitter Card
- ✅ モバイル対応（Viewport）

### パフォーマンス
- ✅ 外部リソース数
- ✅ インラインCSS/スタイル
- ✅ 画像の遅延読み込み

## AIによる回答構造

SEO改善に関する質問に対して、AIは必ず以下の3段階の構造で回答します：

### 1. 【現状分析】
- 現在のSEO要素の状態を数値と共に明確に示す
- タイトル、ディスクリプション、見出し構造、画像alt属性、構造化データなどの現状を分析
- 最適値との比較を示す（例：タイトルは45文字で、最適範囲30-60文字内）

### 2. 【課題整理】
- 現状分析から見つかった問題点を整理
- 優先度の高い課題から順に列挙
- 各課題がSEOに与える影響を説明
- 緊急度・重要度を考慮

### 3. 【改善提案】
- 各課題に対する具体的な改善方法を提示
- 実装可能な具体的な改善案を提示（例：タイトルの改善案、ディスクリプションの改善案）
- 優先順位をつけて改善すべき順序を提示
- 可能であれば、改善前後の比較も示す

## 具体的な改善提案の例

分析結果に基づいて、AIが以下のような具体的な改善提案を提供します：

1. **タイトル最適化**
   - 現在のタイトル長と最適範囲の比較
   - 改善案の提案

2. **ディスクリプション最適化**
   - 現在の長さと最適範囲の比較
   - 改善案の提案

3. **見出し構造の改善**
   - H1の数が適切か
   - 見出しの階層構造が適切か

4. **画像最適化**
   - alt属性の不足している画像の指摘
   - 改善提案

5. **構造化データの追加**
   - 不足している構造化データの提案

6. **パフォーマンス改善**
   - CSS最適化の提案
   - リソース読み込みの最適化提案

## 実装ファイル

- `analytics/seo_analyzer.py` - SEO分析モジュール
- `analytics/ai_analytics_chat.py` - AIチャット統合（SEO分析機能追加）
- `pages/analytics_chat.py` - UI更新（URL入力フィールド追加）

## 依存関係

以下のパッケージが追加されました：

```
requests>=2.28.0
beautifulsoup4>=4.11.0
lxml>=4.9.0
```

## 注意事項

- スクレイピングは適切な間隔を空けて実行してください
- 対象サイトの利用規約を確認してください
- 認証が必要なページは分析できません
- タイムアウトは10秒に設定されています

## 今後の拡張予定

- 複数ページの一括分析
- 競合サイトとの比較分析
- パフォーマンススコアの詳細分析
- 自動レポート生成

