# OAuth 2.0 GA4 APIé€£æº å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿè£…æ—¥**: 2025å¹´10æœˆ11æ—¥  
**å¯¾è±¡ã‚µã‚¤ãƒˆ**: https://isetan.mistore.jp/moodmark  
**GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID**: 316302380

---

## å®Ÿè£…æ¦‚è¦

OAuth 2.0ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’ä½¿ç”¨ã—ãŸGoogle Analytics 4 (GA4) APIé€£æºã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã”è‡ªèº«ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é–²è¦§æ¨©é™ã‚’ä½¿ç”¨ã—ã¦ã€GA4ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## å®Ÿè£…å†…å®¹

### 1. ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

#### ğŸ“ analytics/oauth_google_apis.py
OAuth 2.0èªè¨¼ã‚’ä½¿ç”¨ã—ãŸGoogle APIsçµ±åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

**ä¸»è¦æ©Ÿèƒ½**:
- OAuth 2.0ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼
- èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ä¿å­˜ã¨æ›´æ–°
- GA4ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- Google Search Consoleãƒ‡ãƒ¼ã‚¿å–å¾—
- ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½

**ä¸»è¦ã‚¯ãƒ©ã‚¹**:
- `OAuthGoogleAPIsIntegration`: OAuth 2.0èªè¨¼ã‚’ä½¿ç”¨ã—ãŸAPIçµ±åˆã‚¯ãƒ©ã‚¹

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `get_ga4_data()`: GA4ãƒ‡ãƒ¼ã‚¿å–å¾—
- `get_gsc_data()`: GSCãƒ‡ãƒ¼ã‚¿å–å¾—
- `get_summary_report()`: çµ±åˆã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- `export_to_csv()`: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

#### ğŸ“ analytics/test_oauth_ga4.py
OAuthèªè¨¼ã¨GA4æ¥ç¶šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ†ã‚¹ãƒˆé …ç›®**:
1. OAuth 2.0èªè¨¼ãƒ†ã‚¹ãƒˆ
2. GA4 APIæ¥ç¶šã¨ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
3. Google Search Console APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
4. ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ

#### ğŸ“ docs/analytics/oauth_setup_guide.md
OAuth 2.0ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®è©³ç´°ã‚¬ã‚¤ãƒ‰

**å†…å®¹**:
- Google Cloud Consoleã§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ‰‹é †
- OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®ä½œæˆæ–¹æ³•
- OAuthåŒæ„ç”»é¢ã®è¨­å®š
- èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œæ‰‹é †
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

#### ğŸ“ analytics/README_OAuth.md
OAuthå®Ÿè£…ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰

**å†…å®¹**:
- ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- ä½¿ç”¨ä¾‹
- APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç‰ˆã¨ã®æ¯”è¼ƒ
- ã‚ˆãã‚ã‚‹è³ªå•

#### ğŸ“ docs/analytics/oauth_implementation_report.md
ã“ã®å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

### 2. æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

#### ğŸ“ config/analytics_config.json
- GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID `316302380` ã‚’è¨­å®š
- ã‚µã‚¤ãƒˆURL `https://isetan.mistore.jp/moodmark` ã‚’è¨­å®š
- GSCã‚µã‚¤ãƒˆURL `sc-domain:isetan.mistore.jp` ã‚’è¨­å®š
- OAuthè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

#### ğŸ“ requirements.txt
ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ :
```
google-auth==2.23.4
google-auth-oauthlib==1.1.0
google-auth-httplib2==0.1.1
google-api-python-client==2.108.0
schedule==1.2.0
```

#### ğŸ“ .gitignore
OAuthé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ãƒªã‚¹ãƒˆã«è¿½åŠ :
- `oauth_credentials.json`
- `config/oauth_credentials.json`
- `config/token.json`

## ä½¿ç”¨æ–¹æ³•

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd /Users/nakamuratakeshi/projects/moodmark
pip install -r requirements.txt
```

### ã‚¹ãƒ†ãƒƒãƒ—2: OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®è¨­å®š

è©³ç´°ãªæ‰‹é †ã¯ `docs/analytics/oauth_setup_guide.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**æ¦‚è¦**:
1. [Google Cloud Console](https://console.cloud.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã¾ãŸã¯é¸æŠ
3. **Google Analytics Data API** ã‚’æœ‰åŠ¹åŒ–
4. **OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªï¼‰ã‚’ä½œæˆ
5. JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
6. `config/oauth_credentials.json` ã¨ã—ã¦ä¿å­˜

### ã‚¹ãƒ†ãƒƒãƒ—3: åˆå›èªè¨¼

```bash
python analytics/test_oauth_ga4.py
```

**å®Ÿè¡Œãƒ•ãƒ­ãƒ¼**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«é–‹ã
2. GA4ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æ‰¿èª
4. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒ `config/token.json` ã«ä¿å­˜ã•ã‚Œã‚‹
5. ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã€çµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ¼ã‚¿å–å¾—

```bash
# ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã¨CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
python analytics/oauth_google_apis.py
```

**å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«**:
- `data/processed/ga4_data_oauth_YYYYMMDD_HHMMSS.csv`
- `data/processed/gsc_data_oauth_YYYYMMDD_HHMMSS.csv`
- `data/processed/summary_report_oauth_YYYYMMDD_HHMMSS.json`

## Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®ä½¿ç”¨ä¾‹

```python
from analytics.oauth_google_apis import OAuthGoogleAPIsIntegration

# ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆåˆå›ã®ã¿ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
api = OAuthGoogleAPIsIntegration()

# éå»30æ—¥é–“ã®GA4ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
ga4_data = api.get_ga4_data(date_range_days=30)
print(f"ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: {ga4_data['sessions'].sum():,.0f}")

# ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã§å–å¾—
custom_data = api.get_ga4_data(
    date_range_days=7,
    metrics=['sessions', 'totalUsers', 'screenPageViews', 'conversions'],
    dimensions=['date', 'deviceCategory', 'pagePath', 'sessionDefaultChannelGrouping']
)

# Google Search Consoleãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
gsc_data = api.get_gsc_data(date_range_days=30)
top_queries = gsc_data.nlargest(10, 'clicks')
print("ä¸Šä½10ä»¶ã®æ¤œç´¢ã‚¯ã‚¨ãƒª:")
print(top_queries[['query', 'clicks', 'impressions', 'position']])

# çµ±åˆã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
summary = api.get_summary_report(date_range_days=30)
print(f"ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: {summary['ga4_summary']['total_users']:,}")
print(f"å¹³å‡ç›´å¸°ç‡: {summary['ga4_summary']['avg_bounce_rate']:.2%}")
print(f"ç·ã‚¯ãƒªãƒƒã‚¯æ•°ï¼ˆGSCï¼‰: {summary['gsc_summary']['total_clicks']:,}")

# CSVã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
api.export_to_csv(ga4_data, 'my_analysis.csv')
```

## åˆ©ç”¨å¯èƒ½ãªGA4ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é–¢é€£
- `sessions`: ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°
- `totalUsers`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- `newUsers`: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- `screenPageViews`: ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æ•°
- `sessionsPerUser`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°

### ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆé–¢é€£
- `bounceRate`: ç›´å¸°ç‡
- `averageSessionDuration`: å¹³å‡ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“
- `engagementRate`: ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡
- `engagedSessions`: ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã®ã‚ã£ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°

### ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–¢é€£
- `conversions`: ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•°
- `eventCount`: ã‚¤ãƒ™ãƒ³ãƒˆæ•°

### åç›Šé–¢é€£
- `totalRevenue`: ç·åç›Š
- `purchaseRevenue`: è³¼å…¥åç›Š
- `ecommercePurchases`: Eã‚³ãƒãƒ¼ã‚¹è³¼å…¥æ•°

## åˆ©ç”¨å¯èƒ½ãªGA4ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³

### æ™‚é–“é–¢é€£
- `date`: æ—¥ä»˜
- `dateHour`: æ—¥ä»˜ã¨æ™‚é–“
- `month`: æœˆ
- `year`: å¹´

### ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£
- `country`: å›½
- `city`: éƒ½å¸‚
- `language`: è¨€èª
- `deviceCategory`: ãƒ‡ãƒã‚¤ã‚¹ã‚«ãƒ†ã‚´ãƒªï¼ˆdesktop/mobile/tabletï¼‰
- `operatingSystem`: OS
- `browser`: ãƒ–ãƒ©ã‚¦ã‚¶

### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é–¢é€£
- `sessionDefaultChannelGrouping`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ£ãƒãƒ«
- `sessionSource`: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚½ãƒ¼ã‚¹
- `sessionMedium`: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¡ãƒ‡ã‚£ã‚¢
- `sessionCampaignName`: ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å

### ãƒšãƒ¼ã‚¸é–¢é€£
- `pagePath`: ãƒšãƒ¼ã‚¸ãƒ‘ã‚¹
- `pageTitle`: ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«
- `landingPage`: ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸

## ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç‰ˆã¨ã®æ¯”è¼ƒ

| é …ç›® | OAuth 2.0ç‰ˆï¼ˆä»Šå›å®Ÿè£…ï¼‰ | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç‰ˆ |
|------|---------------------|-------------------|
| **èªè¨¼æ–¹å¼** | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ |
| **åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—** | ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ | JSONã‚­ãƒ¼é…ç½®ã®ã¿ |
| **æ¨©é™ç®¡ç†** | å€‹äººã®GA4æ¨©é™ã‚’ä½¿ç”¨ | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ¨©é™ä»˜ä¸ãŒå¿…è¦ |
| **ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†** | è‡ªå‹•æ›´æ–°ï¼ˆæœ‰åŠ¹æœŸé™ã‚ã‚Šï¼‰ | ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæœŸé™ãªã—ï¼‰ |
| **é©ç”¨å ´é¢** | å€‹äººä½¿ç”¨ã€é–‹ç™ºç’°å¢ƒã€ãƒ†ã‚¹ãƒˆ | æœ¬ç•ªç’°å¢ƒã€è‡ªå‹•åŒ–ã€ã‚µãƒ¼ãƒãƒ¼é‹ç”¨ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ç´ä»˜ã | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå˜ç‹¬ |
| **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«** | `oauth_google_apis.py` | `google_apis_integration.py` |
| **ãƒ¡ãƒªãƒƒãƒˆ** | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜<br>æ¨©é™ç®¡ç†ãŒä¸è¦ | å®Œå…¨è‡ªå‹•åŒ–å¯èƒ½<br>ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ä¸è¦ |
| **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ** | ãƒˆãƒ¼ã‚¯ãƒ³ã«æœ‰åŠ¹æœŸé™ã‚ã‚Š<br>åˆå›ã«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ | GA4å´ã§æ¨©é™è¨­å®šãŒå¿…è¦<br>ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†ãŒå¿…è¦ |

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**çµ¶å¯¾ã«Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„**:

1. **config/oauth_credentials.json**
   - OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™
   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¬¬ä¸‰è€…ã«æ¸¡ã™ã¨ã€ã‚ãªãŸã®åå‰ã§ã‚¢ãƒ—ãƒªãŒä½œæˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

2. **config/token.json**
   - ã‚ãªãŸã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã¾ã™
   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¬¬ä¸‰è€…ã«æ¸¡ã™ã¨ã€ã‚ãªãŸã®GA4ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã§é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ãŒã€å¿µã®ãŸã‚ç¢ºèªã—ã¦ãã ã•ã„:

```bash
# é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
git status

# ã‚‚ã—èª¤ã£ã¦ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦ã—ã¾ã£ãŸå ´åˆ
git reset HEAD config/oauth_credentials.json
git reset HEAD config/token.json
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ã®è¨­å®š

```bash
# é©åˆ‡ãªæ¨©é™ã‚’è¨­å®šï¼ˆè‡ªåˆ†ã ã‘ãŒèª­ã¿æ›¸ãå¯èƒ½ï¼‰
chmod 600 config/oauth_credentials.json
chmod 600 config/token.json
```

### ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™

- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯é€šå¸¸1æ™‚é–“ã§æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™
- ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™
- é•·æœŸé–“ä½¿ç”¨ã—ãªã„å ´åˆã¯ã€`config/token.json` ã‚’å‰Šé™¤ã—ã¦å†èªè¨¼ã—ã¦ãã ã•ã„

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ã€Œèªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€

**ã‚¨ãƒ©ãƒ¼**:
```
OAuthèªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: config/oauth_credentials.json
```

**è§£æ±ºæ–¹æ³•**:
1. Google Cloud Consoleã§OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä½œæˆ
2. ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã€ã¨ã—ã¦ä½œæˆ
3. JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
4. `config/oauth_credentials.json` ã¨ã—ã¦ä¿å­˜

### å•é¡Œ2: ã€Œã“ã®ã‚¢ãƒ—ãƒªã¯ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€è­¦å‘Š

**è­¦å‘Šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ**:
- ã€Œè©³ç´°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- ã€ŒMOOD MARK Analyticsï¼ˆå®‰å…¨ã§ã¯ãªã„ãƒšãƒ¼ã‚¸ï¼‰ã«ç§»å‹•ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- ã“ã‚Œã¯è‡ªåˆ†ã§ä½œæˆã—ãŸã‚¢ãƒ—ãƒªãªã®ã§å®‰å…¨ã§ã™

### å•é¡Œ3: ã€Œæ¨©é™ã‚¨ãƒ©ãƒ¼ã€

**ã‚¨ãƒ©ãƒ¼**:
```
æ¨©é™ã‚¨ãƒ©ãƒ¼: GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„
```

**è§£æ±ºæ–¹æ³•**:
1. GA4ã®ç®¡ç†ç”»é¢ (https://analytics.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID `316302380` ã‚’ç¢ºèª
3. ã€Œç®¡ç†ã€â†’ã€Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã€ã§è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã€Œé–²è¦§è€…ã€ä»¥ä¸Šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª
4. æ­£ã—ã„Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ç¢ºèª

### å•é¡Œ4: ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„

**ç—‡çŠ¶**: ã‚¨ãƒ©ãƒ¼ãªã—ã§ãƒ‡ãƒ¼ã‚¿ãŒ0è¡Œ

**ç¢ºèªé …ç›®**:
1. GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID `316302380` ãŒæ­£ã—ã„ã‹
2. æŒ‡å®šæœŸé–“ã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹
3. GA4ã§ãƒ‡ãƒ¼ã‚¿ãŒå®Ÿéš›ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒãƒ¼ãƒˆã§ç¢ºèªï¼‰

### å•é¡Œ5: ãƒˆãƒ¼ã‚¯ãƒ³ã®æœŸé™åˆ‡ã‚Œ

**ç—‡çŠ¶**: ä»¥å‰ã¯å‹•ä½œã—ã¦ã„ãŸãŒã€çªç„¶ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**è§£æ±ºæ–¹æ³•**:
```bash
# ãƒˆãƒ¼ã‚¯ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm config/token.json

# å†åº¦ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
python analytics/test_oauth_ga4.py

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å†èªè¨¼
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿åé›†ã®è‡ªå‹•åŒ–

cronã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§å®šæœŸå®Ÿè¡Œ:

```bash
# crontabã®ä¾‹ï¼ˆæ¯æ—¥9æ™‚ã«å®Ÿè¡Œï¼‰
0 9 * * * cd /Users/nakamuratakeshi/projects/moodmark && /usr/local/bin/python analytics/oauth_google_apis.py >> logs/oauth_analytics.log 2>&1
```

### 2. ã‚«ã‚¹ã‚¿ãƒ åˆ†æã®å®Ÿè£…

```python
# ä¾‹: ãƒ‡ãƒã‚¤ã‚¹åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡åˆ†æ
from analytics.oauth_google_apis import OAuthGoogleAPIsIntegration
import pandas as pd

api = OAuthGoogleAPIsIntegration()

# ãƒ‡ãƒã‚¤ã‚¹åˆ¥ãƒ‡ãƒ¼ã‚¿å–å¾—
data = api.get_ga4_data(
    date_range_days=30,
    metrics=['sessions', 'conversions'],
    dimensions=['deviceCategory']
)

# ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡ã‚’è¨ˆç®—
data['conversion_rate'] = (data['conversions'] / data['sessions'] * 100).round(2)
print(data)
```

### 3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®é€£æº

- Looker Studioã¸ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é€£æº
- Streamlitãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ä½œæˆ
- BIãƒ„ãƒ¼ãƒ«ã¨ã®çµ±åˆ

### 4. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

```python
# ä¾‹: ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•°ãŒé–¾å€¤ã‚’ä¸‹å›ã£ãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ
summary = api.get_summary_report(date_range_days=7)
if summary['ga4_summary']['total_conversions'] < 10:
    print("âš ï¸ è­¦å‘Š: ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•°ãŒä½ä¸‹ã—ã¦ã„ã¾ã™")
    # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚„Slacké€šçŸ¥ãªã©ã‚’è¿½åŠ 
```

## ãƒªã‚½ãƒ¼ã‚¹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰**: [docs/analytics/oauth_setup_guide.md](oauth_setup_guide.md)
- **ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ**: [analytics/README_OAuth.md](../../analytics/README_OAuth.md)
- **å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«

### å¤–éƒ¨ãƒªãƒ³ã‚¯

- [Google Analytics Data API v1](https://developers.google.com/analytics/devguides/reporting/data/v1)
- [OAuth 2.0 for Desktop Apps](https://developers.google.com/identity/protocols/oauth2/native-app)
- [Google Cloud Console](https://console.cloud.google.com/)
- [GA4ç®¡ç†ç”»é¢](https://analytics.google.com/)

### ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

- **åŸºæœ¬çš„ãªä½¿ç”¨**: `analytics/oauth_google_apis.py` ã® `main()` é–¢æ•°
- **ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**: `analytics/test_oauth_ga4.py`

## å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### âœ… å®Œäº†é …ç›®

- [x] OAuth 2.0èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ
- [x] GA4ãƒ‡ãƒ¼ã‚¿å–å¾—æ©Ÿèƒ½ã®å®Ÿè£…
- [x] Google Search Consoleé€£æºã®å®Ÿè£…
- [x] ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½
- [x] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [x] ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ
- [x] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ï¼ˆGA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID: 316302380ï¼‰
- [x] requirements.txtã®æ›´æ–°
- [x] .gitignoreã®æ›´æ–°
- [x] ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã®ä½œæˆ
- [x] READMEã®ä½œæˆ
- [x] å®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ

### ğŸ“‹ ä»Šå¾Œã®æ‹¡å¼µå€™è£œ

- [ ] çµ±åˆåˆ†æã‚·ã‚¹ãƒ†ãƒ ï¼ˆ`integrated_analytics_system.py`ï¼‰ã®OAuthå¯¾å¿œç‰ˆ
- [ ] Looker Studioè‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- [ ] ãƒ¡ãƒ¼ãƒ«/Slacké€šçŸ¥æ©Ÿèƒ½
- [ ] ç•°å¸¸æ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆStreamlitï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ï¼ˆBigQueryï¼‰ã¨ã®é€£æº

## ã¾ã¨ã‚

OAuth 2.0ã‚’ä½¿ç”¨ã—ãŸGA4 APIé€£æºã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

âœ… **ç°¡å˜ãªèªè¨¼**: ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã ã‘ã§GA4ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹  
âœ… **è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å–å¾—**: éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•çš„ã«å–å¾—ã—ã¦CSVä¿å­˜  
âœ… **æŸ”è»Ÿãªåˆ†æ**: ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã§è©³ç´°åˆ†æ  
âœ… **çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ**: GA4ã¨Search Consoleã®ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆ  
âœ… **ã‚»ã‚­ãƒ¥ã‚¢**: èªè¨¼æƒ…å ±ã¯Gitç®¡ç†å¤–ã§å®‰å…¨ã«ä¿ç®¡  

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

---

**å®Ÿè£…è€…**: AI Assistant  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å¿…è¦ã«å¿œã˜ã¦ã”ç¢ºèªãã ã•ã„  
**è³ªå•ãƒ»ã‚µãƒãƒ¼ãƒˆ**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã€ã¾ãŸã¯ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„

[[memory:8388227]]

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `docs/analytics/oauth_implementation_report.md` ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚


